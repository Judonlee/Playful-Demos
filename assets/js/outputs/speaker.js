/*
 * A Speaker that says Sounds
 * http://www.happyworm.com
 *
 * Copyright (c) 2014 Happyworm Ltd
 * Licensed under the MIT license.
 * http://opensource.org/licenses/MIT
 *
 * Author: Mark J Panaghiston
 * Version: 0.0.1
 * Date: 27th May 2014
 */

(function(PM) {

	var DEBUG = false;

	var Speaker = function(options) {
		this.init(options);
	};

	if(typeof PM === 'undefined') {
		window.Speaker = Speaker; // 
	} else {
		PM.Speaker = function(options) {
			return new Speaker(options); // 
		};
	}

	Speaker.prototype = {
		init: function(options) {
			var self = this;
			// The default options
			this.options = {
				id: '', // The id for broadcasts
				audio: [{
					id: 'heartbeat',
					url: 'assets/audio/heart/heartbeat.wav'
				}],
				callback: null,
				context: null
			};
			// Read in instancing options.
			for(var option in options) {
				if(options.hasOwnProperty(option)) {
					this.options[option] = options[option];
				}
			}
			// The Web Audio API context
			this.context = PM && PM.context ? PM.context : this.options.context;

			// Setup the Sounds
			var item;
			this.sound = {};


			for(var i = 0, iLen = this.options.audio.length; i < iLen; i++) {
				item = this.options.audio[i];
				this.sound[item.id] = PM.Sound({
					id: item.id,
					audio: item.url
				});
			}
/*
			var i = 0, iLen = this.options.audio.length;
			var setupSound = function() {
				item = self.options.audio[i];
				self.sound[item.id] = PM.Sound({
					id: item.id,
					audio: item.url,
					callback: function() {
						if(++i < iLen) {
							setTimeout(setupSound, 0);
						}
					}
				});
			};
			setupSound();
*/
		},
		broadcast: function(type) {
			// Broadcast the message
			if(PM) {
				PM.broadcast(type, {
					id: this.options.id,
					target: this,
					msg: 'Generated by: Speaker'
				});
			}
		},
		play: function(id) {
			if(this.sound[id]) {
				this.sound[id].play();
			}
		}
	}
}(window.PM));
