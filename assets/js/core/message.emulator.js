/*
 * Message Emulator
 * http://www.happyworm.com
 *
 * Copyright (c) 2014 Happyworm Ltd
 * Licensed under the MIT license.
 * http://opensource.org/licenses/MIT
 *
 * Author: Mark J Panaghiston
 * Version: 0.0.1
 * Date: 14th April 2014
 */

(function(PM) {

	var DEBUG = true;

	var MessageEmulator = function(options) {
		this.init(options);
	};

	if(typeof PM === 'undefined') {
		window.MessageEmulator = MessageEmulator; // 
	} else {
		PM.MessageEmulator = function(options) {
			return new MessageEmulator(options); // 
		};
	}

	MessageEmulator.prototype = {
		init: function(options) {
			// The default options
			this.options = {
				id: "",
				target: null,
				className: "message-emulator",
				title: "Message Title",
				type: "pm_event_emulator"
			};
			// Read in instancing options.
			for(var option in options) {
				if(options.hasOwnProperty(option)) {
					this.options[option] = options[option];
				}
			}
			this.target = typeof this.options.target === 'string' ? document.querySelector(this.options.target) : this.options.target;
			this.createGUI();
		},
		createGUI: function() {
			var span = document.createElement('span');
			span.className = this.options.className;
			span.innerHTML = this.options.title;


			var type = this.options.type;
			if(typeof type === 'string') {
				type = [type];
			}
			for(var i = 0, iLen = type.length; i < iLen; i++) {
				span.appendChild(this.createButton(type[i]));
			}

			if(this.target) {
				this.target.appendChild(span);
			}
		},
		createButton: function(type) {
			var self = this;
			var button = document.createElement('button');
			button.innerHTML = type;
			button.addEventListener('click', function() {
				self.broadcast(type);
			}, false);
			return button;
		},
		broadcast: function(type) {
			if(PM) {
				PM.broadcast(type, {
					id: this.options.id,
					target: this,
					msg: 'Generated by: MessageEmulator'
				});
			}
		}
	}
}(window.PM));
